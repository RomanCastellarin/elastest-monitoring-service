stream string cookie := if e.path(cookie) then e.getstr(cookie) 
stream string usr := if e.path(cookie) then e.getstr(usr)
stream bool getVerdict := if e.path(getVerdict) then e.strcmp(getVerdict, "true")

stream string op := if e.path(op) then e.getstr(op)
strean string arg := if e.path(arg) then e.getstr(arg)

stream string verdict := if goodTransition then "ok" else "fail"

stream bool goodTransition := goodLogin \/ goodTest \/ goodLogout
stream bool goodLogin := stateUp.op == "login" /\ arg == usr
stream bool goodTest := stateUp.op == "test" /\ arg == cookie 
stream bool goodLogout := stateUp.op == "logout" /\ arg == prev(cookie)

trigger getVerdict do emit `{"verdict": "%verdict", "op": "%op", "arg": "%arg"}` on #out
